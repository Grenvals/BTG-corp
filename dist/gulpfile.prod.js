"use strict";var gulp=require("gulp"),browserSync=require("browser-sync"),plumber=require("gulp-plumber"),del=require("del"),tinypng=require("gulp-tinypng-compress"),imagemin=require("gulp-imagemin"),imageminJpegRecompress=require("imagemin-jpeg-recompress"),pngquant=require("imagemin-pngquant"),cache=require("gulp-cache"),newer=require("gulp-newer"),rigger=require("gulp-rigger"),concat=require("gulp-concat"),uglify=require("gulp-uglify"),sourcemaps=require("gulp-sourcemaps"),sass=require("gulp-sass"),autoprefixer=require("gulp-autoprefixer"),cleancss=require("gulp-clean-css"),pug=require("gulp-pug"),pugInheritance=require("gulp-pug-inheritance"),changed=require("gulp-changed"),cached=require("gulp-cached"),gulpif=require("gulp-if"),filter=require("gulp-filter"),kit=require("gulp-kit"),svgSprite=require("gulp-svg-sprite"),svgmin=require("gulp-svgmin"),cheerio=require("gulp-cheerio"),replace=require("gulp-replace"),BrowserSyncConfig={server:{baseDir:"./build"},tunnel:!1,host:"localhost",port:3e3,notify:!1,online:!1},filePath={pug:{in:"./src/pug/*.pug",out:"./build/"},kit:{in:"src/kit/*.kit",out:"./build/"},sass:{in:"./src/sass/style.scss",out:"build/css/",finalBuild:"compressed"},jsLibs:{in:["./src/js/libs/#AddLibs.js"],out:"build/js"},jsScripts:{in:"./src/js/*.js",out:"build/js"},img:{}};gulp.task("pug",function(){return gulp.src(filePath.pug.in).pipe(plumber()).pipe(changed("dist",{extension:".html"})).pipe(gulpif(global.isWatching,cached("pug"))).pipe(pugInheritance({basedir:"./src/pug/",skip:"node_modules"})).pipe(filter(function(e){return!/\/_/.test(e.path)&&!/^_/.test(e.relative)})).pipe(pug({pretty:!0})).pipe(plumber.stop()).pipe(gulp.dest(filePath.pug.out))}),gulp.task("kit",function(){return gulp.src("src/kit/*.kit").pipe(plumber()).pipe(kit()).pipe(gulp.dest("build/"))}),gulp.task("sassDev",function(){return gulp.src("./src/sass/style.scss").pipe(plumber()).pipe(sourcemaps.init()).pipe(sass().on("error",function(e){console.log(e)})).pipe(autoprefixer({overrideBrowserslist:["last 10 versions"]})).pipe(sourcemaps.write(".")).pipe(gulp.dest("build/css/")).pipe(browserSync.stream())}),gulp.task("sassBuild",function(){return gulp.src(["./src/sass/style.scss"]).pipe(sass({outputStyle:"compressed"})).pipe(cleancss({level:{1:{specialComments:0}}})).pipe(autoprefixer({overrideBrowserslist:["last 10 versions"]})).pipe(gulp.dest("build/css/"))}),gulp.task("libsDev",function(){return gulp.src(["./src/js/libs/*.js","./src/js/libs/#AddLibs.js"]).pipe(plumber()).pipe(sourcemaps.init()).pipe(rigger()).pipe(concat("libs.js")).pipe(sourcemaps.write(".")).pipe(gulp.dest("build/js")).pipe(browserSync.stream())}),gulp.task("libsBuild",function(){return gulp.src(["./src/js/libs/*.js","./src/js/libs/#AddLibs.js"]).pipe(rigger()).pipe(concat("libs.js")).pipe(uglify()).pipe(gulp.dest("build/js"))}),gulp.task("scriptsDev",function(){return gulp.src("./src/js/*.js").pipe(plumber()).pipe(gulp.dest("build/js")).pipe(browserSync.stream())}),gulp.task("scriptsBuild",function(){return gulp.src(["./src/js/*.js"]).pipe(uglify()).pipe(gulp.dest("build/js"))}),gulp.task("imgMover",function(){return gulp.src(["!./src/img/svg/","!./src/img/_compress/","./src/img/**/*"]).pipe(gulp.dest("build/img/"))}),gulp.task("imgCompressMover",function(){return gulp.src(["!./src/img/_compress/*.tinypng-sigs","./src/img/_compress/**/*"]).pipe(gulp.dest("build/img/"))}),gulp.task("tinyPngHandler",function(){return gulp.src(["!./src/img/svg/","!./src/img/_compress/","./src/img/**/*"]).pipe(tinypng({key:"78UEHTVIN19cuH3B5ZsGUaTWJ6Vsv3Ev",sigFile:"src/img/_compress/.tinypng-sigs",log:!0})).pipe(gulp.dest("./src/img/_compress/"))}),gulp.task("imgOflineHandler",function(){return gulp.src(["!./src/img/svg/","!./src/img/_compress/","./src/img/**/*"]).pipe(newer("./build/img/")).pipe(imagemin([imagemin.gifsicle({interlaced:!0}),imagemin.mozjpeg({progressive:!0}),imageminJpegRecompress({loops:5,min:70,max:75,quality:"high"}),imagemin.svgo(),imagemin.optipng({optimizationLevel:3}),pngquant([.8,.8])],{verbose:!0})).pipe(gulp.dest("./build/img/"))}),gulp.task("svg",function(){return gulp.src("./src/img/svg/*.svg").pipe(svgmin({js2svg:{pretty:!0}})).pipe(cheerio({run:function(e){e("[fill]").removeAttr("fill"),e("[stroke]").removeAttr("stroke"),e("[style]").removeAttr("style")},parserOptions:{xmlMode:!0}})).pipe(replace("&gt;",">")).pipe(svgSprite({mode:{symbol:{sprite:"sprite.svg"}}})).pipe(gulp.dest("./build/img/svg"))}),gulp.task("fonts",function(){return gulp.src("./src/fonts/**/*").pipe(gulp.dest("build/fonts/")).pipe(browserSync.stream())}),gulp.task("clearBuild",function(){return del(["build/*"])}),gulp.task("watch",function(){browserSync.init(BrowserSyncConfig),gulp.watch("./src/**/*.pug",gulp.parallel("pug")).on("change",browserSync.reload),gulp.watch("./src/**/*.kit",gulp.parallel("kit")).on("change",browserSync.reload),gulp.watch("./src/**/*.scss",gulp.parallel("sassDev")),gulp.watch("./src/img/svg/*.svg",gulp.parallel("svg")),gulp.watch("./src/js/*.js",gulp.parallel("scriptsDev")),gulp.watch("./src/js/libs/*.js",gulp.parallel("libsDev"))}),gulp.task("dev",gulp.series("clearBuild",gulp.parallel("pug","kit","sassDev","libsDev","scriptsDev","svg","fonts"))),gulp.task("build",gulp.series("clearBuild","pug","kit","sassBuild","libsBuild","scriptsBuild","svg","fonts")),gulp.task("default",gulp.series("dev",gulp.parallel("watch")));